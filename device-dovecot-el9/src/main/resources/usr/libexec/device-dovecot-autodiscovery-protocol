#!/bin/bash

#
# Dovecot Autodiscovery - Protocol
# ================================
# 
# This script autogenerates the protocol configuration for a dovecot server.

set -e
umask 0022

myhostname=$(cat /etc/hostname)

logger -t "${0}" "Notice: Creating dovecot 10-protocol.conf..."

cat >> "10-protocol.conf" <<- EOF
# Generated by $0 on `date`
# DO NOT MODIFY THIS FILE - it will be overwritten on server restart.
#

protocols = lmtp
EOF

if test ! -f "/etc/device/services/mail/imap/disabled.bin"; then

  cat >> "10-protocol.conf" <<- EOF
# Note: imap enabled because /etc/device/services/mail/imap/disabled.bin does not exist
protocols = \$protocols imap
EOF

fi

if test ! -f "/etc/device/services/mail/pop3/disabled.bin"; then

  cat >> "10-protocol.conf" <<- EOF
# Note: pop enabled because /etc/device/services/mail/pop3/disabled.bin does not exist
protocols = \$protocols pop3
EOF

fi

if test ! -f "/etc/device/services/mail/submission/disabled.bin"; then

  cat >> "10-protocol.conf" <<- EOF
# Note: submission enabled because /etc/device/services/mail/submission/disabled.bin does not exist
protocols = \$protocols submission
EOF

fi


